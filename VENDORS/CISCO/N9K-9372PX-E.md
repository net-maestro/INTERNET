# 1. Общее описание

**Cisco Nexus 9372PX-E** – это высокопроизводительный коммутатор серии Nexus 9000, ориентированный на центры обработки данных и высоконагруженные сети. Он обеспечивает:

- Высокую плотность 10 Gigabit Ethernet (10 Гбит/с) и 40 Gigabit Ethernet (40 Гбит/с) портов.
- Низкую задержку (порядка единиц микросекунд).
- Аппаратное ускорение для L2/L3-функций (Layer 2 / Layer 3).
- Совместимость с операционной системой Cisco NX-OS (а также с режимом ACI при определённых моделях/лицензиях, если требуется интеграция с Cisco Application Centric Infrastructure).

# 2. Конфигурация портов

- **48 портов SFP+**: Каждый порт может работать на скорости 1/10 Гбит/с  SFP+ .
- **6 портов QSFP+**: Каждый QSFP+ работает на скорости 40 Гбит/с. При необходимости порты могут быть «разбиты» (breakout) в 4×10 Гбит/с каждый (с помощью breakout-кабеля QSFP+ → 4×SFP+).

Таким образом, базовая пропускная способность по портам:

- 48 × 1/10 Гбит/с = 480 Гбит/с
- 6 × 40 Гбит/с = 240 Гбит/с

**Итого в сумме** = 720 Гбит/с (в одну сторону). При учёте двунаправленной передачи (full-duplex) считается 1,44 Тбит/с «суммарной» пропускной способности.

# 3. Производительность (pps)

В спецификациях коммутатора указывается:

- **Общая пропускная способность (switching capacity / forwarding bandwidth)** – до 1,44 Тбит/с (full-duplex).
- **Производительность в пакетах (forwarding rate)** – до порядка 1,0–1,07 млрд пакетов в секунду (bpps) при учёте минимального размера пакета (64 байта).
- Иногда в документации встречается округлённое значение ~ 720+ млн pps в одну сторону или ~1,44 млрд pps в суммарном двунаправленном подсчёте.

Ориентируйтесь на официальную документацию Cisco, где обычно указывается величина порядка 1,07 Bpps как теоретический максимум для Nexus 9372PX(-E).

# 4. Аппаратные ресурсы

Ниже приведён типовой набор аппаратных лимитов для Nexus 9300 (конкретные значения могут незначительно меняться в зависимости от версии NX-OS и лицензий):

- **MAC-адреса**: до 128 000.
- **Записи маршрутов (IPv4/IPv6)**: до 128 000 (хостов) / 16 000–48 000 (мультикаст и т.п.).
- **VLAN**: до 4096 VLAN-идентификаторов.
- **ACL (правила)**: до ~14 000 (TCAM entries).
- **VRF**: до 4000.
- **Размер буфера (shared buffer)**: ~25 МБ (точное значение зависит от конкретного чипсета в «E»-серии).
- **Объём DRAM (системная память)**: 16 ГБ.
- **Внутренний SSD**: 64 ГБ (для хранения образов NX-OS, журналов, конфигураций и т.д.).
- **Форм-фактор**: 1RU (высота 44 мм, глубина ~437 мм, ширина ~438 мм).
- **Питание**: поддержка резервированных блоков питания (AC/DC опции), типичная потребляемая мощность ~230 Вт, максимальная ~295 Вт (зависит от нагрузки и оптических модулей).

# 5. Поддержка selective Q-in-Q

## Что такое selective Q-in-Q

Q-in-Q (или Double VLAN tagging, IEEE 802.1ad) – это функция, позволяющая инкапсулировать кадры, уже имеющие VLAN-тег (802.1Q), в ещё один внешний VLAN-тег. 
Это используется для изоляции клиентских VLAN в сетях провайдеров, а также в ряде сценариев дата-центров.

**Selective Q-in-Q** (или «избирательный Q-in-Q») – это расширенная функция, позволяющая применять «второй тег» не ко всем входящим VLAN’ам, а к выбранным. 
Обычно это настраивается через match-правила (ACL, class-map и т.п.), где указываются, какие конкретно VLAN (или диапазоны VLAN) попадут под «добавление второго тега».

## Поддержка на Cisco Nexus 9300

В линейке Cisco Nexus 9000 (включая 9372PX-E) поддержка Q-in-Q и selective Q-in-Q существует, но требует:

- Соответствующую версию Cisco NX-OS, где данная функция включена (обычно это любая современная версия NX-OS 7.x/9.x, но убедитесь в Release Notes).
- Соответствующие лицензионные уровни, если функция вынесена в Advanced Feature Set (чаще всего базовый L2 пакет таких коммутаторов покрывает Q-in-Q, но в некоторых случаях могут потребоваться дополнительные лицензии).

Типовая настройка **selective Q-in-Q** сводится к указанию, для каких VLAN на входном интерфейсе будет добавляться дополнительный тег (outer VLAN), а какие будут передаваться «как есть» или с трансляцией VLAN.

Пример (очень упрощённый) команды в Cisco NX-OS:

```bash
interface Ethernet1/1
  switchport mode trunk
  switchport vlan mapping 100 dot1q-tunnel 300
  switchport vlan mapping 101 dot1q-tunnel 301
```


### Пример полной конфигурации
- В конфигурации создаются основные VLAN: 10, 20, 30 (внутренние клиентские VLAN) и 100, 200 (внешние VLAN для инкапсуляции).
- Настройка switchport vlan mapping на интерфейсе позволяет задать, какие VLAN получат внешний тег, а какие будут передаваться без изменений.
- VLAN 10 и 20 получают соответствующие теги 100 и 200, а VLAN 30 передаётся как есть, без добавления внешнего тега.
- Для портов trunk, как на клиентских устройствах, так и на uplink, используется инкапсуляция dot1q для корректной работы Q-in-Q.


```bash
! Настройка интерфейсов и VLAN
vlan 10
  name Q-in-Q-VLAN-10
vlan 20
  name Q-in-Q-VLAN-20
vlan 30
  name Q-in-Q-VLAN-30
vlan 100
  name Outer-VLAN-100
vlan 200
  name Outer-VLAN-200

! Настройка trunk портов для Q-in-Q
interface Ethernet1/1
  description "Trunk Port to Client 1"
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30
  switchport trunk encapsulation dot1q
  switchport vlan mapping 10 dot1q-tunnel 100
  switchport vlan mapping 20 dot1q-tunnel 200
  no shutdown

interface Ethernet1/2
  description "Trunk Port to Client 2"
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30
  switchport trunk encapsulation dot1q
  switchport vlan mapping 10 dot1q-tunnel 100
  switchport vlan mapping 20 dot1q-tunnel 200
  no shutdown

! Настройка порта для выхода с инкапсуляцией Q-in-Q
interface Ethernet1/3
  description "Uplink to Core Switch"
  switchport mode trunk
  switchport trunk allowed vlan 100,200
  switchport trunk encapsulation dot1q
  no shutdown

! Настройка на выходном порту для Selective Q-in-Q
interface Ethernet1/4
  description "Trunk Port to Core"
  switchport mode trunk
  switchport trunk allowed vlan 100,200
  switchport trunk encapsulation dot1q
  switchport vlan mapping 100 dot1q-tunnel 300
  switchport vlan mapping 200 dot1q-tunnel 400
  no shutdown

! Включение Selective Q-in-Q для трафика, приходящего с определённых VLAN
interface Ethernet1/1
  switchport mode trunk
  switchport trunk encapsulation dot1q
  switchport vlan mapping 10 dot1q-tunnel 100
  switchport vlan mapping 20 dot1q-tunnel 200
  switchport trunk allowed vlan 10,20,30
  no shutdown
```

## 6. Дополнительные возможности

Помимо основного функционала L2/L3, коммутатор поддерживает ряд передовых функций для ЦОД:

- **VxLAN** (в том числе аппаратное ускорение VTEP) – для построения оверлейных сетей.
- **MPLS** (частично) – начиная с определённых версий NX-OS, но это требует дополнительной лицензии и не всегда поддерживается на всех моделях «E».
- **Cisco ACI Mode** – при условии работы под управлением контроллера APIC (необходима спецификация ACI-совместимых версий оборудования и ПО).
- **OTV, LISP, FabricPath** – некоторые из этих технологий могут поддерживаться только на моделях Nexus 9000 с определёнными лицензиями; важно проверять Release Notes для каждой конкретной версии ПО.
- **sFlow / NetFlow** (поддержка телеметрии).
- **FEX (Fabric Extender)** – до 16 FEX’ов.
- **VPC (Virtual PortChannel)** – стандартная функция для объединения Nexus-коммутаторов в пару и обеспечения отказоустойчивых L2-каналов без STP-блокировок.

## 7. Итог

Cisco Nexus N9K-9372PX-E – это 1RU-коммутатор с 48 × 1/10G SFP+ и 6 × 40G QSFP+ портами, способный пропускать до 1,44 Тбит/с и обрабатывать примерно до 1,0–1,07 млрд пакетов/с.
Он поддерживает классические функции L2/L3, включая расширенные механизмы работы с VLAN (Q-in-Q, selective Q-in-Q), при условии корректных версий NX-OS и соответствующей конфигурации.

Если вашей задачей является именно развертывание selective Q-in-Q (например, гибкая логическая изоляция нескольких клиентских VLAN на одном физическом/транковом интерфейсе), следует убедиться, что:

- Установлена совместимая версия NX-OS (обычно 7.x или 9.x и выше).
- Включены нужные лицензии (LAN Enterprise и т.д., при необходимости).
- Настройка selective Q-in-Q произведена с помощью vlan mapping и/или соответствующих policy-map/class-map.

Таким образом, Nexus 9372PX-E обеспечивает высокую производительность, гибкие возможности конфигурации VLAN (включая selective Q-in-Q) и подходит для современных дата-центров с высокой плотностью 10/40G портов.
