# Полное руководство по NetBox для сетевых инженеров ISP (на примере украинской инфраструктуры)

NetBox — это мощная система управления IP-адресами (IPAM) и инфраструктурой (DCIM), разработанная для сетевых инженеров и интернет-провайдеров. Она помогает управлять IP-адресами, устройствами, стойками, VLAN, автономными системами (AS) и другими сетевыми сущностями. Это открытый инструмент, идеальный для документирования и автоматизации сетевой инфраструктуры.

Руководство охватывает миграцию данных, установку, рекомендуемую иерархию, полезные функции и примеры workflow. Адаптировано под нужды украинского ISP с примерами из украинской инфраструктуры (Киев, Львов, Одесса, Харьков, Днепр). Применимо как для новых установок, так и для обновления существующих систем.

## 0. Установка NetBox
Перед миграцией или использованием разверните NetBox. Есть несколько способов:

- **Официальная документация**: Подробное руководство по установке доступно на [https://docs.netbox.dev/en/stable/](https://docs.netbox.dev/en/stable/).
- **Docker-развертывание**: Удобный вариант для быстрого запуска. Используйте репозиторий [https://github.com/netbox-community/netbox-docker](https://github.com/netbox-community/netbox-docker). Подходит для тестового или продуктивного окружения.
- **Установка на bare-metal (Ubuntu/CentOS)**: Установите на виртуальной машине или сервере. Требует PostgreSQL, Redis и Python. Следуйте шагам из документации.

После установки:
- Зайдите в веб-интерфейс (обычно по адресу `http://your-server:8000`).
- Создайте суперпользователя через команду `python manage.py createsuperuser` или в интерфейсе.
- Настройте базовые параметры: часовой пояс (например, Europe/Kyiv), валюту (UAH) и интеграции (если нужны).

## 1. Определение источников данных
Для начала определите, где хранятся ваши **авторитетные данные** (источники истины) — системы или файлы, содержащие актуальную информацию о вашей сети. Например:
- Excel-таблица с IP-префиксами для клиентских подключений в Киеве.
- CRM-система с данными о клиентах (например, "Укртелеком" или локальная база).
- Конфигурации коммутаторов в текстовых файлах или системах вроде RANCID.

**Что нужно сделать**:
- Найдите все источники данных, которые использует ваша команда. Это могут быть:
  - Таблицы с IP-адресами и VLAN (например, для клиентов в Одессе или Львове).
  - Списки клиентских подключений (порты, услуги, адреса).
  - Схемы сети (стойки, коммутаторы на узлах в Харькове или Днепре).
- Проверьте, чтобы:
  - Все согласны, что эти данные актуальны.
  - Область применения данных четко определена (например, "таблица X — источник для IP клиентов в Киеве").
- **Типичные проблемы**:
  - Разные команды используют разные таблицы или системы для одних и тех же данных (например, одна команда в Киеве использует Excel, другая в Одессе — Google Sheets).
  - Данные хранятся в неудобных форматах (например, текстовые заметки в Notion).
  - Некоторые данные не документированы (например, IP-адреса, выданные вручную для клиентов в Виннице).
- **Действия**: Составьте список всех источников данных вашей сети и определите, какие из них нужно перенести в NetBox.

## 2. Какие данные переносить в NetBox
NetBox — это инструмент для управления сетевой инфраструктурой и IP-адресами (IPAM/DCIM). Переносите данные, которые соответствуют его моделям:
- **Сетевые объекты**: IP-префиксы, IP-адреса, VLAN, VRF, AS, BGP-сессии.
- **Физическая инфраструктура**: стойки, коммутаторы, маршрутизаторы, кабели, инвентарь (модули SFP).
- **Клиентские подключения**: информация о клиентах, их портах и услугах (если хотите вести это в NetBox).

**Для украинского ISP**:
- Переносите данные о **IP-префиксах** (например, 185.1.2.0/24 для клиентов в Киеве или 94.178.0.0/16 для внутренней сети).
- Учитывайте **VLAN** для клиентских подключений или сегментации (например, VLAN 100 для интернета, VLAN 200 для IPTV в Днепре).
- Фиксируйте **физические подключения** (например, порты на коммутаторах в узле Львова, к которым подключены клиенты).
- **Клиентские данные**: В NetBox есть модели для учета клиентов (Tenants), которые можно использовать для связи клиентских услуг с IP-адресами, VLAN или портами (например, клиент "ТОВ Світ" в Харькове).

**Расширение NetBox**:
- Если чего-то не хватает (например, поле для "ID договора клиента"), добавьте **пользовательские поля** (Custom Fields). Например, поле для номера договора в модели устройства или IP-адреса.
- Для сложных задач создавайте **плагины**, чтобы добавить новые функции (например, интеграция с украинской CRM-системой).

**Когда не переносить**:
- Если данные лучше хранить в другой системе (например, DNS-записи в сервере BIND или биллинг в 1С), интегрируйте NetBox с ней, вместо переноса.
- Оцените, стоит ли переносить нестандартные данные (например, статистика трафика клиентов).

**Совет**: NetBox постоянно развивается. Если нужной модели нет, проверьте планы разработчиков или предложите свою идею через запрос функции.

## 3. Проверка данных перед переносом
Качество данных в NetBox зависит от качества исходных данных (**"мусор на входе — мусор на выходе"**). Перед миграцией:
- Проверьте данные на полноту и корректность:
  - Убедитесь, что все IP-адреса, VLAN и подключения актуальны (например, IP для клиентов в Одессе соответствуют выделенным префиксам).
  - Используйте структурированные форматы (JSON или CSV) для удобного импорта.
- Настройте в NetBox **правила валидации** (например, формат именования коммутаторов, таких как "KYIV-SW01" или "LVIV-RTR01").
- Для повторяющихся данных используйте скрипты (например, для создания стандартных VLAN для каждого узла в Украине).

**Пример для украинского ISP**:
- Проверьте, что все клиентские IP-адреса соответствуют префиксам, зарегистрированным в RIPE NCC.
- Убедитесь, что порты коммутаторов в узле Харькова задокументированы.
- Проверьте согласованность VLAN (например, VLAN 300 для VoIP в Днепре).

**Важно**: NetBox может проверять техническую корректность (например, что кабель подключен к правильным портам), но только вы можете подтвердить, что данные соответствуют реальной сети.

## 4. Порядок импорта данных и рекомендуемая иерархия
Для новой базы данных важно соблюдать порядок создания объектов, чтобы учесть зависимости. Для ISP в Украине логично начинать с **глобальных объектов** (провайдеры, AS) и двигаться к **локальным** (устройства, IP). Вот расширенный порядок:

1. **Провайдеры (Providers)**: Добавьте upstream-провайдеров и партнеров по пирингу (`NetBox → IPAM → Providers`). Пример: "Укртелеком", "Vega Telecom", укажите название, AS, контакты.
2. **Автономные системы (ASN)**: Добавьте свои AS (`NetBox → IPAM → ASNs`). Пример: AS12345, привяжите к провайдеру.
3. **Группы клиентов и клиенты (Tenant Groups, Tenants)**: Группы (например, "Фізичні особи", "Юридичні особи") и конкретные клиенты (например, "ТОВ Світ").
4. **Регионы, сайты и локации (Regions, Sites)**: Физические местоположения (например, "Київ, вул. Хрещатик", "Львів, пл. Ринок").
5. **Стойки и их роли (Racks)**: Стойки на узлах (например, "Клієнтська стійка" в Днепре).
6. **Производители и типы устройств**: Например, Mikrotik и модель RB4011.
7. **Платформы и роли устройств**: Платформы (RouterOS) и роли ("Клієнтський комутатор").
8. **Устройства и модули (Devices, Modules)**: Конкретные устройства (коммутатор в Одессе).
9. **Интерфейсы (Interfaces)**: Типы (SFP+), MAC-адреса.
10. **Провайдеры цепей и цепи (Circuit Providers, Circuits)**: Магистральные линки (например, "10Gbps от Укртелеком").
11. **VRF и маршруты (VRFs, Route Targets)**: Для изоляции сетей.
12. **IP-префиксы, адреса и диапазоны (Prefixes, IP Addresses, IP Ranges)**: Префиксы (185.1.2.0/24), адреса.
13. **VLAN (VLAN Groups, VLANs)**: VLAN 100 для интернета.
14. **Кластеры и виртуальные машины (Clusters, Virtual Machines)**: Если используются.

**Совет**: Начните с провайдеров и AS, затем сайты и стойки, потом устройства и сети. Это облегчит масштабирование.

## 5. Зависимости моделей для ISP
NetBox имеет зависимости между моделями, которые важно учитывать:
- **Клиенты**:
  - **TenantGroup** → **Tenant** → **Site** → **Device/Prefix/VLAN**.
  - Пример: Группа "Юридичні особи" → клиент "ТОВ Світ" → узел "Харків" → IP 185.1.2.10 и VLAN 100.
- **Сайты и устройства**:
  - **Region** → **SiteGroup** → **Site** → **Location/Rack** → **Device**.
  - Пример: Регион "Захід" → группа сайтов "Львів" → сайт "Львів, пл. Ринок" → стойка → коммутатор Mikrotik.
- **IP и VLAN**:
  - **VLANGroup** → **VLAN**.
  - **Role** → **IPRange/Prefix** → **IPAddress**.
  - **RIR** → **Aggregate** (например, RIPE NCC для ваших префиксов).
  - **RouteTarget** → **VRF** → **IPAddress**.
  - Пример: VLAN 100 → префикс 185.1.2.0/24 → IP 185.1.2.10 для клиента в Одессе.
- **Цепи**:
  - **Provider** → **CircuitType** → **Circuit** → **CircuitTermination**.
  - Пример: Линк от "Укртелеком" до узла в Киеве.
- **Кластеры**:
  - **ClusterGroup** → **ClusterType** → **Cluster** → **VirtualMachine**.

**Примечание**: Некоторые модели (например, регионы или группы клиентов) могут быть иерархическими (например, регион "Україна" → регион "Київська область").

## 6. Полезные фишки для украинского ISP
- **BGP-сессии**: Добавляйте через плагин `NetBox → Plugins → BGP` (если установлен). Удобно для документирования peering с провайдерами вроде "Укртелеком".
- **Кабельная логистика**: `DCIM → Cables` — документируйте патч-корды и оптику между устройствами.
- **Инвентаризация**: `DCIM → Inventory Items` — отслеживайте модули (SFP, RAM) для устройств в узлах (например, в Львове).
- **API**: Автоматизируйте через REST API (`/api/`). Интегрируйте с биллингом или мониторингом (например, Zabbix).
- **Плагины**: Установите расширения для BGP, peering или интеграции с украинскими системами.
- **Резервирование IP**: Автоматически резервируйте пулы для клиентов (например, из префикса 185.1.2.0/24).

## 7. Пример workflow для украинского ISP
1. Добавляем провайдеров ("Укртелеком", "Datagroup").
2. Регистрируем свои AS (AS12345).
3. Создаем сайты ("Київ DC1", "Львів POP1").
4. Размечаем стойки ("Rack A1-A10").
5. Добавляем устройства ("Core-Router-1" в Киеве, "Access-SW-5" в Одессе).
6. Настраиваем интерфейсы и IP ("xe-0/0/0: 203.0.113.1/30").
7. Создаем VLAN ("VLAN 100: Customers" для интернета).
8. Резервируем префиксы ("203.0.113.0/24" для клиентов в Днепре).

## Примечания для украинского ISP
- **Клиенты (Tenants)**: Используйте для учета клиентских подключений. Например, свяжите клиента "ТОВ Світ" с его IP, VLAN и портом на коммутаторе в Харькове.
- **IPAM**: NetBox идеально подходит для управления IP-префиксами, зарегистрированными в RIPE NCC, и адресами клиентов.
- **Физическая инфраструктура**: Документируйте стойки, коммутаторы и кабели на узлах (например, в Киеве или Львове) для быстрого устранения неисправностей.
- **Автоматизация**: Используйте скрипты для массового импорта данных (например, загрузка всех VLAN или IP из CSV).
- **Интеграция**: Если вы используете украинскую CRM или биллинг (например, 1С), подумайте об интеграции через API NetBox.
- **Вывод**: NetBox — отличный инструмент для ISP, если правильно организовать иерархию. Начинайте с провайдеров и AS, затем сайты и стойки, потом устройства и сети. Это упростит масштабирование в украинской инфраструктуре.
