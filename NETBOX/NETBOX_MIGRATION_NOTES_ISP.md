# Руководство по миграции в NetBox для сетевых инженеров ISP (на примере украинской инфраструктуры)

Этот документ — краткое и понятное руководство для сетевых инженеров интернет-провайдера (ISP) в Украине, планирующих миграцию данных в NetBox. Оно адаптировано под нужды ISP, с упором на управление сетевой инфраструктурой, IP-адресами и клиентскими подключениями в украинском контексте. Руководство применимо как для новых установок NetBox, так и для добавления данных в существующие системы.

## 1. Определение источников данных
Для начала определите, где хранятся ваши **авторитетные данные** (источники истины) — системы или файлы, содержащие актуальную информацию о вашей сети. Например:
- Excel-таблица с IP-префиксами для клиентских подключений в Киеве.
- CRM-система с данными о клиентах (например, "Укртелеком" или локальная база).
- Конфигурации коммутаторов в текстовых файлах или системах вроде RANCID.

**Что нужно сделать**:
- Найдите все источники данных, которые использует ваша команда. Это могут быть:
  - Таблицы с IP-адресами и VLAN (например, для клиентов в Одессе или Львове).
  - Списки клиентских подключений (порты, услуги, адреса).
  - Схемы сети (стойки, коммутаторы на узлах в Харькове или Днепре).
- Проверьте, чтобы:
  - Все согласны, что эти данные актуальны.
  - Область применения данных четко определена (например, "таблица X — источник для IP клиентов в Киеве").
- **Типичные проблемы**:
  - Разные команды используют разные таблицы или системы для одних и тех же данных (например, одна команда в Киеве использует Excel, другая в Одессе — Google Sheets).
  - Данные хранятся в неудобных форматах (например, текстовые заметки в Notion).
  - Некоторые данные не документированы (например, IP-адреса, выданные вручную для клиентов в Виннице).
- **Действия**: Составьте список всех источников данных вашей сети и определите, какие из них нужно перенести в NetBox.

## 2. Какие данные переносить в NetBox
NetBox — это инструмент для управления сетевой инфраструктурой и IP-адресами (IPAM/DCIM). Переносите данные, которые соответствуют его моделям:
- **Сетевые объекты**: IP-префиксы, IP-адреса, VLAN, VRF.
- **Физическая инфраструктура**: стойки, коммутаторы, маршрутизаторы, кабели.
- **Клиентские подключения**: информация о клиентах, их портах и услугах (если хотите вести это в NetBox).

**Для украинского ISP**:
- Переносите данные о **IP-префиксах** (например, 185.1.2.0/24 для клиентов в Киеве или 94.178.0.0/16 для внутренней сети).
- Учитывайте **VLAN** для клиентских подключений или сегментации (например, VLAN 100 для интернета, VLAN 200 для IPTV в Днепре).
- Фиксируйте **физические подключения** (например, порты на коммутаторах в узле Львова, к которым подключены клиенты).
- **Клиентские данные**: В NetBox есть модели для учета клиентов (Tenants), которые можно использовать для связи клиентских услуг с IP-адресами, VLAN или портами (например, клиент "ТОВ Світ" в Харькове).

**Расширение NetBox**:
- Если чего-то не хватает (например, поле для "ID договора клиента"), добавьте **пользовательские поля** (Custom Fields). Например, поле для номера договора в модели устройства или IP-адреса.
- Для сложных задач создавайте **плагины**, чтобы добавить новые функции (например, интеграция с украинской CRM-системой).

**Когда не переносить**:
- Если данные лучше хранить в другой системе (например, DNS-записи в сервере BIND или биллинг в 1С), интегрируйте NetBox с ней, вместо переноса.
- Оцените, стоит ли переносить нестандартные данные (например, статистика трафика клиентов).

**Совет**: NetBox постоянно развивается. Если нужной модели нет, проверьте планы разработчиков или предложите свою идею через запрос функции.

## 3. Проверка данных перед переносом
Качество данных в NetBox зависит от качества исходных данных (**"мусор на входе — мусор на выходе"**). Перед миграцией:
- Проверьте данные на полноту и корректность:
  - Убедитесь, что все IP-адреса, VLAN и подключения актуальны (например, IP для клиентов в Одессе соответствуют выделенным префиксам).
  - Используйте структурированные форматы (JSON или CSV) для удобного импорта.
- Настройте в NetBox **правила валидации** (например, формат именования коммутаторов, таких как "KYIV-SW01" или "LVIV-RTR01").
- Для повторяющихся данных используйте скрипты (например, для создания стандартных VLAN для каждого узла в Украине).

**Пример для украинского ISP**:
- Проверьте, что все клиентские IP-адреса соответствуют префиксам, зарегистрированным в RIPE NCC.
- Убедитесь, что порты коммутаторов в узле Харькова задокументированы.
- Проверьте согласованность VLAN (например, VLAN 300 для VoIP в Днепре).

**Важно**: NetBox может проверять техническую корректность (например, что кабель подключен к правильным портам), но только вы можете подтвердить, что данные соответствуют реальной сети.

## 4. Порядок импорта данных
Для новой базы данных важно соблюдать порядок создания объектов, чтобы учесть зависимости. Вот упрощенный порядок для украинского ISP:

1. **Группы клиентов и клиенты** (Tenant Groups, Tenants):
   - **Tenant Groups**: Группы клиентов (например, "Фізичні особи", "Юридичні особи").
   - **Tenants**: Конкретные клиенты (например, "ТОВ Світ" или "ФОП Іванов"). Это связывает услуги, IP и порты с клиентом.
2. **Сайты и локации**: Узлы сети (например, "Київ, вул. Хрещатик", "Львів, пл. Ринок") и их физические локации (здания, этажи).
3. **Стойки и их роли**: Стойки на узлах и их назначение (например, "Клієнтська стійка", "Магістральна стійка").
4. **Производители и типы устройств**: Например, Mikrotik (производитель) и модель RB4011 (тип устройства).
5. **Платформы и роли устройств**: Платформы (например, RouterOS, IOS) и роли (например, "Клієнтський комутатор", "Маршрутизатор ядра").
6. **Устройства и модули**: Конкретные коммутаторы, маршрутизаторы и их модули (например, коммутатор на узле в Одессе).
7. **Провайдеры и цепи**: Данные о магистральных провайдерах (например, "Укртелеком", "10Gbps линк до Києва").
8. **VRF и маршруты**: VRF для разделения клиентских и внутренних сетей, цели маршрутов (Route Targets).
9. **IP-префиксы и адреса**: Префиксы (например, 185.1.2.0/24), диапазоны IP и конкретные адреса.
10. **VLAN**: Группы VLAN и сами VLAN (например, VLAN 100 для интернета, VLAN 200 для IPTV в Днепре).
11. **Кластеры и виртуальные машины** (если используются): Например, виртуальные машины для сетевого мониторинга.

**Совет**: Начните с клиентских групп и узлов, затем переходите к IP и VLAN, так как они ключевые для клиентских подключений.

## 5. Зависимости моделей для ISP
NetBox имеет зависимости между моделями, которые важно учитывать:
- **Клиенты**:
  - **TenantGroup** → **Tenant** → **Site** → **Device/Prefix/VLAN**.
  - Пример: Группа "Юридичні особи" → клиент "ТОВ Світ" → узел "Харків" → IP 185.1.2.10 и VLAN 100.
- **Сайты и устройства**:
  - **Region** → **SiteGroup** → **Site** → **Location/Rack** → **Device**.
  - Пример: Регион "Захід" → группа сайтов "Львів" → сайт "Львів, пл. Ринок" → стойка → коммутатор Mikrotik.
- **IP и VLAN**:
  - **VLANGroup** → **VLAN**.
  - **Role** → **IPRange/Prefix** → **IPAddress**.
  - **RIR** → **Aggregate** (например, RIPE NCC для ваших префиксов).
  - **RouteTarget** → **VRF** → **IPAddress**.
  - Пример: VLAN 100 → префикс 185.1.2.0/24 → IP 185.1.2.10 для клиента в Одессе.
- **Цепи**:
  - **Provider** → **CircuitType** → **Circuit** → **CircuitTermination**.
  - Пример: Линк от "Укртелеком" до узла в Киеве.
- **Кластеры**:
  - **ClusterGroup** → **ClusterType** → **Cluster** → **VirtualMachine**.
  - Используется для виртуальных машин, если вы управляете ими через NetBox.

**Примечание**: Некоторые модели (например, регионы или группы клиентов) могут быть иерархическими (например, регион "Україна" → регион "Київська область").

## Примечания для украинского ISP
- **Клиенты (Tenants)**: Используйте для учета клиентских подключений. Например, свяжите клиента "ТОВ Світ" с его IP, VLAN и портом на коммутаторе в Харькове.
- **IPAM**: NetBox идеально подходит для управления IP-префиксами, зарегистрированными в RIPE NCC, и адресами клиентов.
- **Физическая инфраструктура**: Документируйте стойки, коммутаторы и кабели на узлах (например, в Киеве или Львове) для быстрого устранения неисправностей.
- **Автоматизация**: Используйте скрипты для массового импорта данных (например, загрузка всех VLAN или IP из CSV).
- **Интеграция**: Если вы используете украинскую CRM или биллинг (например, 1С), подумайте об интеграции через API NetBox.
